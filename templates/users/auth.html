{% extends 'base.html' %}

{% block title %}
    {% if is_signup %}Sign Up{% else %}Sign In{% endif %} - PayJoint
{% endblock %}

{% block extra_head %}
<style type="text/tailwindcss">
    :root {
        --bg-deep-navy: #000814;
        --accent-royal-blue-dark: #001d3d;
        --accent-royal-blue-medium: #003566;
        --highlight-gold-yellow: #ffc300;
        --highlight-gold-yellow-darker: #ffd60a;
        --text-primary: #ffffff;
        --text-secondary: #a9a9a9;
    }
    body {
        background-color: var(--bg-deep-navy);
        font-family: 'Roboto', sans-serif;
    }
    h1, h2, h3, h4, h5, h6 {
        font-family: 'Montserrat', sans-serif;
    }
    .login-container::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: conic-gradient(
            from 0deg at 50% 50%,
            var(--accent-royal-blue-dark) 0%,
            var(--accent-royal-blue-medium) 30%,
            var(--bg-deep-navy) 60%,
            var(--bg-deep-navy) 100%
        );
        animation: rotate 10s linear infinite;
    }
    .page-background::after {
        content: '';
        position: absolute;
        inset: 0;
        background-image: radial-gradient(circle, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 2rem 2rem;
        opacity: 0.5;
    }
    @keyframes rotate {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
    .tab-button.active {
        color: var(--highlight-gold-yellow);
        border-bottom-color: var(--highlight-gold-yellow);
    }
    .tab-content {
        display: none;
    }
    .tab-content.active {
        display: block;
    }
    /* Common input styling for direct HTML rendering */
    .auth-input-style {
        @apply w-full px-4 py-3 bg-[var(--accent-royal-blue-dark)] border border-[var(--accent-royal-blue-medium)] rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[var(--highlight-gold-yellow-darker)] transition-shadow duration-300;
    }
</style>
{% endblock %}

{% block optional_header_content %}
{# This block is now defined in base.html. We will put the nav and auth buttons here #}
{# so they appear on auth.html (login/signup) like on index.html #}
<nav class="hidden items-center gap-8 md:flex">
    <a class="text-sm font-medium text-[var(--text-light)] transition-colors hover:text-[var(--bright-yellow)]" href="{% url 'users:index' %}">Home</a>
    <a class="text-sm font-medium text-[var(--text-light)] transition-colors hover:text-[var(--bright-yellow)]" href="{% url 'users:index' %}#benefits">Benefits</a>
    <a class="text-sm font-medium text-[var(--text-light)] transition-colors hover:text-[var(--bright-yellow)]" href="{% url 'users:index' %}#features">Features</a>
</nav>
<div class="flex items-center gap-4">
    {# These buttons depend on whether it's login or signup page #}
    {% if user.is_authenticated %}
        {# This case shouldn't happen often if user is redirected when authenticated, but for completeness #}
        <span class="text-sm font-medium text-[var(--text-light)]">Welcome, {{ user.email }}!</span>
        <a href="{% url 'groups:dashboard' %}" class="rounded-lg bg-[var(--dark-blue)] px-6 py-2 text-sm font-bold text-[var(--white)] transition-transform hover:scale-105 hover:bg-[var(--royal-blue)]">
            Dashboard
        </a>
        <a href="{% url 'logout' %}" class="rounded-lg bg-transparent px-6 py-2 text-sm font-bold text-[var(--white)] ring-1 ring-inset ring-[var(--royal-blue)] transition-transform hover:scale-105 hover:bg-[var(--royal-blue)]">
            Log Out
        </a>
    {% else %}
        {# Show Sign up or Log in based on is_signup context #}
        {% if is_signup %}
            <a href="{% url 'users:login' %}" class="rounded-lg bg-transparent px-6 py-2 text-sm font-bold text-[var(--white)] ring-1 ring-inset ring-[var(--royal-blue)] transition-transform hover:scale-105 hover:bg-[var(--royal-blue)]">
                Log in
            </a>
        {% else %} {# This is the login page #}
            <a href="{% url 'users:signup' %}" class="rounded-lg bg-[var(--dark-blue)] px-6 py-2 text-sm font-bold text-[var(--white)] transition-transform hover:scale-105 hover:bg-[var(--royal-blue)]">
                Sign up
            </a>
        {% endif %}
    {% endif %}
</div>
{% endblock optional_header_content %}


{% block content %}
<div class="relative min-h-screen flex items-center justify-center p-4 overflow-hidden page-background">
    <div class="login-container relative max-w-md w-full">
        <div class="relative bg-[var(--bg-deep-navy)] rounded-2xl p-8 z-10">
            <div class="text-center mb-8">
                <div class="flex justify-center items-center mb-4">
                    <div class="w-16 h-16 bg-[var(--accent-royal-blue-medium)] rounded-full flex items-center justify-center">
                        <span class="text-2xl font-bold text-[var(--highlight-gold-yellow)]">PJ</span>
                    </div>
                </div>
                {# Conditional titles based on is_signup context #}
                {% if is_signup %}
                    <h1 class="text-3xl font-bold text-white mb-2">Join PayJoint,</h1>
                    <h2 class="text-3xl font-bold text-[var(--highlight-gold-yellow)]">Start Splitting Bills!</h2>
                {% else %}
                    <h1 class="text-3xl font-bold text-white mb-2">Split the bill,</h1>
                    <h2 class="text-3xl font-bold text-[var(--highlight-gold-yellow)]">not the friendship.</h2>
                {% endif %}
            </div>
            <div class="mb-8">
                <div class="flex border-b border-b-[var(--accent-royal-blue-medium)]">
                    <a href="{% url 'users:login' %}" class="tab-button flex-1 py-3 text-lg font-bold text-[var(--text-secondary)] border-b-2 border-transparent hover:text-white transition-colors duration-300 {% if not is_signup %}active{% endif %}" id="login-tab-button">Login</a>
                    <a href="{% url 'users:signup' %}" class="tab-button flex-1 py-3 text-lg font-bold text-[var(--text-secondary)] border-b-2 border-transparent hover:text-white transition-colors duration-300 {% if is_signup %}active{% endif %}" id="signup-tab-button">Sign Up</a>
                </div>
            </div>

            {# Login Tab Content #}
            <div class="tab-content {% if not is_signup %}active{% endif %}" id="login-tab">
                <form method="post" action="{% url 'users:login' %}" class="space-y-6">
                    {% csrf_token %}
                    {% if messages %}
                        <div class="mb-4">
                            {% for message in messages %}
                                <div class="p-3 rounded-md mb-2 text-sm
                                    {% if 'success' in message.tags %}bg-green-100 text-green-700{% elif 'error' in message.tags %}bg-red-100 text-red-700{% elif 'info' in message.tags %}bg-blue-100 text-blue-700{% elif 'warning' in message.tags %}bg-yellow-100 text-yellow-700{% endif %}">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2" for="{{ form.username.id_for_label }}">{{ form.username.label }}</label>
                        <input type="email" name="{{ form.username.html_name }}" id="{{ form.username.id_for_label }}" class="auth-input-style" placeholder="Enter your email" value="{{ form.username.value|default:'' }}" {% if form.username.field.required %}required{% endif %}>
                        {% for error in form.username.errors %}<p class="text-red-500 text-xs mt-1">{{ error }}</p>{% endfor %}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2" for="{{ form.password.id_for_label }}">{{ form.password.label }}</label>
                        <input type="password" name="{{ form.password.html_name }}" id="{{ form.password.id_for_label }}" class="auth-input-style" placeholder="Your password" {% if form.password.field.required %}required{% endif %}>
                        {% for error in form.password.errors %}<p class="text-red-500 text-xs mt-1">{{ error }}</p>{% endfor %}
                    </div>
                    {% if form.non_field_errors %}
                        <div class="text-red-500 text-sm mb-4">
                            {% for error in form.non_field_errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                    {% endif %}
                    <button class="w-full bg-[var(--highlight-gold-yellow)] text-[var(--bg-deep-navy)] font-bold py-3 px-4 rounded-lg hover:bg-[var(--highlight-gold-yellow-darker)] transition-colors duration-300 transform hover:scale-105 shadow-lg shadow-[var(--highlight-gold-yellow)]/20" type="submit">
                        Login
                    </button>
                </form>
            </div>

            {# Signup Tab Content #}
            <div class="tab-content {% if is_signup %}active{% endif %}" id="signup-tab">
                <form method="post" action="{% url 'users:signup' %}" class="space-y-6">
                    {% csrf_token %}
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2" for="{{ form.username.id_for_label }}">Username</label>
                        <input type="text" name="{{ form.username.html_name }}" id="{{ form.username.id_for_label }}" class="auth-input-style" placeholder="Create a username" value="{{ form.username.value|default:'' }}" {% if form.username.field.required %}required{% endif %}>
                        {% for error in form.username.errors %}<p class="text-red-500 text-xs mt-1">{{ error }}</p>{% endfor %}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2" for="{{ form.email.id_for_label }}">{{ form.email.label }}</label>
                        <input type="email" name="{{ form.email.html_name }}" id="{{ form.email.id_for_label }}" class="auth-input-style" placeholder="Enter your email" value="{{ form.email.value|default:'' }}" {% if form.email.field.required %}required{% endif %}>
                        {% for error in form.email.errors %}<p class="text-red-500 text-xs mt-1">{{ error }}</p>{% endfor %}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2" for="{{ form.password.id_for_label }}">{{ form.password.label }}</label>
                        <input type="password" name="{{ form.password.html_name }}" id="{{ form.password.id_for_label }}" class="auth-input-style" placeholder="Create a Password" {% if form.password.field.required %}required{% endif %}>
                        {% for error in form.password.errors %}<p class="text-red-500 text-xs mt-1">{{ error }}</p>{% endfor %}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2" for="{{ form.password2.id_for_label }}">Confirm Password</label>
                        <input type="password" name="{{ form.password2.html_name }}" id="{{ form.password2.id_for_label }}" class="auth-input-style" placeholder="Confirm your password" {% if form.password2.field.required %}required{% endif %}>
                        {% for error in form.password2.errors %}<p class="text-red-500 text-xs mt-1">{{ error }}</p>{% endfor %}
                    </div>
                    {% if form.non_field_errors %}
                        <div class="text-red-500 text-sm mb-4">
                            {% for error in form.non_field_errors %}<p>{{ error }}</p>{% endfor %}
                        </div>
                    {% endif %}
                    <button class="w-full bg-[var(--highlight-gold-yellow)] text-[var(--bg-deep-navy)] font-bold py-3 px-4 rounded-lg hover:bg-[var(--highlight-gold-yellow-darker)] transition-colors duration-300 transform hover:scale-105 shadow-lg shadow-[var(--highlight-gold-yellow)]/20" type="submit">Create Account</button>
                </form>
            </div>

            <div class="mt-12 text-center text-xs text-[var(--text-secondary)]">
                <p class="mb-2">By continuing, you agree to our</p>
                <div class="flex justify-center space-x-4">
                    <a class="hover:text-white hover:underline underline-offset-4 transition-colors duration-300" href="#">Terms of Service</a>
                    <span class="text-gray-500">|</span>
                    <a class="hover:text-white hover:underline underline-offset-4 transition-colors duration-300" href="#">Privacy Policy</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // The original JS for tab switching is replaced by Django's URL routing.
    // The 'active' class is now applied based on the 'is_signup' context from Django view.
    // The form submissions are handled by Django.
</script>
{% endblock %}